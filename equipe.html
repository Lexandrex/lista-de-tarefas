<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Minhas Equipes - Tarefa App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="dashboard.html">Tarefa App - Minhas Equipes</a>
      <div class="ms-auto">
        <button class="btn btn-outline-light" onclick="logout()">Sair</button>
      </div>
    </div>
  </nav>

  <main class="container py-4">
    <h2>Minhas Equipes</h2>
    <p>Veja as equipes às quais você pertence.</p>

    <div id="teamsList" class="list-group">
      <!-- As equipes do usuário serão listadas aqui -->
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
  <script src="js/supabase.js"></script>
  <script>
    // Logout
    async function logout() {
      await supabase.auth.signOut();
      window.location.href = "index.html";
    }

    // Função para carregar as equipes do usuário
    async function carregarEquipes() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        alert("Sessão expirada. Faça login novamente.");
        window.location.href = "index.html";
        return;
      }

      // Buscando as equipes do usuário através de uma tabela de relacionamento
      const { data, error } = await supabase
        .from('team_members')
        .select('teams(name, id)')
        .eq('user_id', user.id);  // Supondo que exista uma tabela de membros de equipe, relacionando usuários e equipes

      if (error) {
        console.error("Erro ao carregar equipes:", error);
        return;
      }

      const teamsList = document.getElementById('teamsList');
      if (data.length === 0) {
        teamsList.innerHTML = '<p class="text-muted">Você não pertence a nenhuma equipe ainda.</p>';
      } else {
        teamsList.innerHTML = '';
        data.forEach(member => {
          const team = member.teams;
          const listItem = document.createElement('a');
          listItem.classList.add('list-group-item', 'list-group-item-action');
          listItem.href = `detalhesEquipe.html?teamId=${team.id}`;
          listItem.textContent = team.name;
          teamsList.appendChild(listItem);
        });
      }
    }

    // Carregar equipes ao carregar a página
    carregarEquipes();
  </script>

</body>
</html>
